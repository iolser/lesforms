{"version":3,"sources":["webpack:///./src/views/CheckIn.vue","webpack:///./src/views/CheckIn.vue?a1bb"],"names":["id","class","style","align","api_data","title","event","authorSearch","type","placeholder","eventSearch","statusSearch","filteredResponses","response","responseIndex","key","author","href","answerer","Date","created_at","toLocaleString","timeSince","updated_at","editor","eventName","loading_status","answerStatuses","changeStatus","name","components","data","undefined","form_responses","displayed_sections","user","statuses","interval","created","form","get","concat","this","$route","params","then","initializeData","queryString","query","initializeAnswers","getStatuses","methods","answer","status","setTimeout","patchStatus","bind","options","method","url","headers","transformResponse","catch","error","console","log","i","sections","length","questions","splice","allFalse","result","filter","x","sectionIndex","section","questionIndex","question","String","content","render"],"mappings":"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","file":"js/chunk-2d0b688d.56f19d4a.js","sourcesContent":["<template>\r\n  <div\r\n    v-if=\"api_data\"\r\n    id=\"responses\"\r\n    class=\"table-container box\"\r\n  >\r\n    <table \r\n      class=\"table is-striped is-hoverable is-fullwidth\" \r\n      style=\"border: 1px solid #dbdbdb;\"\r\n    >\r\n      <caption class=\"mb-0 p-2\">\r\n        <span class=\"title\">{{ api_data.title }}</span><br><span class=\"subtitle\">Registo de participantes\r\n        </span>\r\n      </caption>\r\n      <thead>\r\n        <tr>\r\n          <th\r\n            style=\"text-align: center; vertical-align: middle;\"\r\n          >\r\n            Participante\r\n          </th>\r\n          <th\r\n            v-if=\"!event\"\r\n            style=\"text-align: center; vertical-align: middle;\"\r\n          >\r\n            Evento\r\n          </th>\r\n          <th\r\n            style=\"text-align: center; vertical-align: middle;\"\r\n          >\r\n            Estado\r\n          </th>\r\n        </tr>\r\n        <tr>\r\n          <th class=\"p-0\">\r\n            <div class=\"field\">\r\n              <div class=\"control has-icons-left\">\r\n                <input\r\n                  v-model=\"authorSearch\"\r\n                  type=\"text\"\r\n                  class=\"input is-info is-small m-0\"\r\n                  placeholder=\"Pesquisar por autor\"\r\n                >\r\n                <span class=\"icon is-small is-left\">\r\n                  <i class=\"fas fa-search\" />\r\n                </span>\r\n              </div>\r\n            </div>\r\n          </th>\r\n          <th \r\n            v-if=\"!event\" \r\n            class=\"p-0\"\r\n          >\r\n            <div class=\"field\">\r\n              <div class=\"control has-icons-left\">\r\n                <input\r\n                  v-model=\"eventSearch\"\r\n                  type=\"text\"\r\n                  class=\"input is-info is-small m-0\"\r\n                  placeholder=\"Pesquisar por evento\"\r\n                >\r\n                <span class=\"icon is-small is-left\">\r\n                  <i class=\"fas fa-search\" />\r\n                </span>\r\n              </div>\r\n            </div>\r\n          </th>\r\n          <th class=\"p-0\">\r\n            <div class=\"field\">\r\n              <div class=\"control has-icons-left\">\r\n                <input\r\n                  v-model=\"statusSearch\"\r\n                  type=\"text\"\r\n                  class=\"input is-info is-small m-0\"\r\n                  placeholder=\"Pesquisar por estado (Validada / Presente)\"\r\n                >\r\n                <span class=\"icon is-small is-left\">\r\n                  <i class=\"fas fa-search\" />\r\n                </span>\r\n              </div>\r\n            </div>\r\n          </th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        <tr\r\n          v-for=\"(response, responseIndex) in filteredResponses()\"\r\n          :key=\"responseIndex\"\r\n        >\r\n          <td class=\"author\">\r\n            <span\r\n              v-if=\"response.author\"\r\n              :href=\"'/profile/'+response.answerer\"\r\n            >{{ response.author }}</span>\r\n            <template v-else>\r\n              Anónimo\r\n            </template><span\r\n              :title=\"new Date(response.created_at).toLocaleString()\"\r\n            >, há {{ timeSince(response.created_at) }}</span><span\r\n              v-if=\"response.created_at != response.updated_at\"\r\n              :class=\"response.created_at != response.updated_at ? 'edited' : ''\"\r\n              :title=\"'Editado por ' + (!response.editor ? 'Anónimo' : response.editor) + ' há ' + timeSince(response.updated_at) + ' (' + new Date(response.updated_at).toLocaleString() + ')'\"\r\n            >*</span><br>\r\n            <a\r\n              :href=\"'/forms/respond/' + response.id + '?event=' + response.event\"\r\n            >Editar Resposta</a>\r\n          </td>\r\n          <td v-if=\"!event\">\r\n            {{ response.eventName }}\r\n          </td>\r\n          <td\r\n            align=\"center\"\r\n            style=\"vertical-align: middle;\"\r\n          >\r\n            <span\r\n              v-if=\"loading_status[response.id] === 'error'\"\r\n              class=\"is-danger connection-error\"\r\n            >\r\n              Houve um erro de conexão. Por favor recarregue a página.\r\n            </span>\r\n            <button\r\n              v-else-if=\"answerStatuses[response.id] == 2\"\r\n              :class=\"{'is-loading is-warning' : loading_status[response.id] === 'loading', 'is-success' : loading_status[response.id] !== 'loading'}\"\r\n              type=\"button\"\r\n              class=\"button\"\r\n              @click=\"answerStatuses[response.id] = 4; changeStatus(response.id, answerStatuses[response.id])\"\r\n            >\r\n              Efetuar registo de participante\r\n            </button>\r\n            <button\r\n              v-else-if=\"answerStatuses[response.id] == 4\"\r\n              :class=\"{'is-loading is-success' : loading_status[response.id] === 'loading', 'is-warning' : loading_status[response.id] !== 'loading'}\"\r\n              type=\"button\"\r\n              class=\"button\"\r\n              @click=\"answerStatuses[response.id] = 2; changeStatus(response.id, answerStatuses[response.id])\"\r\n            >\r\n              Cancelar registo de participante\r\n            </button>\r\n            <span v-else>\r\n              Inscrição não validada\r\n            </span>\r\n            <!-- <div \r\n                class=\"select is-rounded is-fullwidth\" \r\n                :class=\"{'is-loading' : loading_status[response.id] === 'loading', 'is-danger connection-error' : loading_status[response.id] === 'error'}\"\r\n              >\r\n                <select\r\n                  v-model=\"answerStatuses[response.id]\"\r\n                  style=\"border-width: 2.5px;\"\r\n                  :style=\"{borderColor: loading_status[response.id] !== 'error' ? statuses[answerStatuses[response.id]].color : ''}\"\r\n                  @change=\"changeStatus(response.id, answerStatuses[response.id])\"\r\n                >\r\n                  <option \r\n                    v-if=\"loading_status[response.id] === 'error'\" \r\n                    value=\"error\" \r\n                    unselectable\r\n                  >\r\n                    Erro de conexão\r\n                  </option>\r\n                  <option\r\n                    v-for=\"(status, key) in statuses\"\r\n                    :key=\"key\"\r\n                    :value=\"key\"\r\n                  >\r\n                    {{ status.name }}\r\n                  </option>\r\n                </select>\r\n              </div> -->\r\n          </td>\r\n        </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport * as components from \"@/fields\";\r\nimport { API } from \"@/http-common\";\r\nimport { decodeSections, getCookie, removeExpositionSections, timeSince, stringIn } from \"@/common\";\r\nexport default {\r\n  name: \"ViewAllResponses\",\r\n  components,\r\n  data() {\r\n    return {\r\n      api_data: undefined,\r\n      form_responses: [],\r\n      displayed_sections: [],\r\n      event: undefined,\r\n      user: undefined,\r\n      statuses: {},\r\n      authorSearch: \"\",\r\n      eventSearch: \"\",\r\n      statusSearch: \"\",\r\n      answerStatuses: [],\r\n      interval : undefined,\r\n      loading_status : {}\r\n    };\r\n  },\r\n  created() {\r\n    const form = API.get(\"form/\".concat(this.$route.params.id))\r\n      .then((response) => \r\n        this.initializeData(response)\r\n      )\r\n    var queryString = \"formAnswer/?form=\".concat(this.$route.params.id);\r\n    if (this.$route.query.event !== undefined) {\r\n      queryString = queryString.concat(\"&event=\").concat(this.$route.query.event)\r\n      API.get(\"event/\".concat(this.$route.query.event))\r\n       .then(response => this.event = response.data.name)\r\n    }\r\n    // if (this.$route.query.user !== undefined) {\r\n    //   queryString = queryString.concat(\"&user=\").concat(this.$route.query.user)\r\n    //   API.get(\"user/\".concat(this.$route.query.user))\r\n    //    .then(response => this.user = response.data.username);\r\n    // }\r\n    API.get(queryString)\r\n      .then(async (response) => {\r\n          await form;\r\n          this.initializeAnswers(response)\r\n        }\r\n      );\r\n\r\n    API.get(\"answerStatus/\")\r\n      .then((response) => {\r\n        this.statuses = response.data;\r\n      });\r\n    this.getStatuses();\r\n    //this.interval = setInterval(() => this.getStatuses(), 10000);\r\n  },\r\n  methods: {\r\n    getStatuses() {\r\n      API.get(\"formAnswerStatus/\")\r\n      .then((response) => {\r\n        this.answerStatuses = response.data;\r\n      });\r\n    },\r\n    changeStatus(answer, status) {\r\n      this.loading_status[answer] = 'loading';\r\n      setTimeout(this.patchStatus.bind(this, answer, status), 0);\r\n    },\r\n    patchStatus(answer, status) {\r\n      const options = {\r\n        method: \"patch\",\r\n        url: \"/formAnswerStatus/\" + answer + \"/\",\r\n        headers: {\r\n          \"X-CSRFToken\": getCookie(\"csrftoken\"),\r\n        },\r\n        data: {\r\n          \"status\": status\r\n        },\r\n        transformResponse: [\r\n          (data) => {\r\n            this.response = data;\r\n            return data;\r\n          },\r\n        ],\r\n      };\r\n      API(options)\r\n        .then(() => this.loading_status[answer] = undefined)\r\n        .catch((error) => {\r\n          console.log(error); \r\n          this.loading_status[answer] = 'error';\r\n          this.answerStatuses[answer] = 'error';\r\n        });\r\n    },\r\n    initializeData(response) {\r\n      this.api_data = removeExpositionSections(response.data);\r\n      for (var i = 0; i < this.api_data.form.sections.length; /*do nothing*/) {\r\n        if (this.api_data.form.sections[i].questions.length > 0)\r\n          this.displayed_sections[i++] = true;\r\n        else\r\n          this.api_data.form.sections.splice(i, 1);\r\n      }\r\n    },\r\n    initializeAnswers(response) {\r\n      this.form_responses = decodeSections(response.data, this.api_data);\r\n    },\r\n    allFalse() {\r\n      for (var i = 0; i < this.displayed_sections.length; i++)\r\n        if (this.displayed_sections[i] == true)\r\n          return false;\r\n      return true;\r\n    },\r\n    filteredResponses() {\r\n      var result = this.form_responses;\r\n      if (this.authorSearch != \"\")\r\n        result = result.filter(x => stringIn(x.author === undefined ? \"Anónimo\" : x.author, this.authorSearch));\r\n      if (this.eventSearch != \"\")\r\n        result = result.filter(x => {return x.eventName ? stringIn(x.eventName, this.eventSearch) : false});\r\n      if (this.statusSearch != \"\")\r\n        result = result.filter(x => stringIn(this.statuses[this.answerStatuses[x.id]].name, this.statusSearch));\r\n      for (var sectionIndex = 0; sectionIndex < this.api_data.form.sections.length; sectionIndex++) {\r\n        if (this.displayed_sections[sectionIndex]) {\r\n          var section = this.api_data.form.sections[sectionIndex];\r\n          for (var questionIndex = 0; questionIndex < section.questions.length; questionIndex++) {\r\n            var question = section.questions[questionIndex]\r\n            if (question.filter && question.filter != \"\")\r\n              result = result.filter(x => stringIn(String(x.content.sections[sectionIndex][questionIndex].answer), question.filter));\r\n          }\r\n        }\r\n      }\r\n      return result;\r\n    },\r\n    timeSince: timeSince\r\n  }\r\n};\r\n</script>\r\n","import { render } from \"./CheckIn.vue?vue&type=template&id=538d6cf6\"\nimport script from \"./CheckIn.vue?vue&type=script&lang=js\"\nexport * from \"./CheckIn.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script"],"sourceRoot":""}